webpackJsonp([84],{"3sOq":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("OvRC"),l=a.n(i),s=a("woOf"),o=a.n(s),n=a("Dd8w"),r=a.n(n),c=a("P9l9"),u=a("sxQs"),d=a("KwM4"),m=a("NYxO"),h={data:function(){return{isSearchLoading:!1,ops:{vuescroll:{},scrollPanel:{scrollingX:!1},rail:{},bar:{background:"#eee"}},tableData:[],columnsPro:[{label:"探访时间",prop:"greetTime"},{label:"探访人员",prop:"greetStaff"},{label:"情况说明",prop:"conditionPresentation"}],columns:[{label:"所属街道",prop:"streetName"},{label:"所属社区",prop:"communityName"},{label:"被访姓名",prop:"intervieweeName"},{label:"被访身份证号",prop:"intervieweeCard"},{label:"年龄",prop:"age"},{label:"电话",prop:"phone"},{label:"住址",prop:"address"},{label:"探访次数",prop:"visitTotal"},{label:"操作",prop:"collectionGridName"}],fullscreen:!0,dialogVisible:!1,selectedLocation:this.$route.query.code&&"string"!=typeof this.$route.query.code?this.$route.query.code.slice(1):[],locationOptions:[],locationProps:{value:"code",label:"name",children:"childs"},smallTabData:[],mealTime:[],checkData:[],formData:{intervieweeName:"",intervieweeCard:"",phone:"",greetStaff:"",beginTime:"",endTime:"",zoneCode:this.initCodeFromQuery(1),streetCode:this.initCodeFromQuery(2),communityCode:this.initCodeFromQuery(3)},pageSize:12,currentPage:1,total:0,smallSize:5,smallPage:1,smallTotal:0,intervieweeCard:""}},computed:r()({},Object(m.b)(["userType","code"]),{userAuthCodeParams:function(){var e={};return 2===this.userType&&(e={zoneCode:this.initCodeFromQuery(1)}),3===this.userType&&(e={streetCode:this.initCodeFromQuery(2)}),4===this.userType&&(e={communityCode:this.initCodeFromQuery(3)}),o()({},{streetCode:"",zoneCode:"",communityCode:""},e)}}),watch:{checkData:function(e){this.getVisitServiceDetailPageInfo(e.intervieweeCard)}},created:function(){var e=this;this.$store.commit("setActiveName","网格员"),this.$store.dispatch("getUserAuthInfo").then(function(){e.getLocation(),e.handleGetSearchValue()}).catch(function(e){console.log("获取用户权限失败",e)}),this.getLocation(),this.handleGetSearchValue()},methods:{getVisitServiceDetailPageInfo:function(e){var t=this;e&&(this.intervieweeCard=e),c.a.getVisitServiceDetailPageInfo({intervieweeCard:this.intervieweeCard,page:this.smallPage,pageSize:this.smallSize}).then(function(e){var a=e&&e.obj,i=a.records,l=a.total;t.smallTabData=i,t.smallTotal=l})},handleGetSmallValue:function(e){this.smallPage=e,this.getVisitServiceDetailPageInfo()},initCodeFromQuery:function(e){return this.$route.query.code&&"string"!=typeof this.$route.query.code&&this.$route.query.code[e]||""},requestParams:function(e){var t=this.selectedLocation.length>0?l()(null):this.userAuthCodeParams;return o()({},this.formData,{page:"number"==typeof e?e:1,pageSize:this.pageSize},t)},handleGetSearchValue:function(e){var t=this;this.isSearchLoading=!0,this.formData.beginTime=1===this.mealTime.length?this.mealTime[0]:"",this.formData.endTime=2===this.mealTime.length?this.mealTime[0]:"",c.a.getVisitServicePageInfo(this.requestParams(e)).then(function(e){t.isSearchLoading=!1;var a=e&&e.obj,i=a.records,l=a.total,s=a.size,o=a.current;i.map(function(e){e.returnStateNew=0==e.returnState?"否":"是",e.isGreetNew=0==e.isGreet?"否":"是"}),t.tableData=i||[],t.pageSize=s,t.currentPage=o,t.total=l}).catch(function(){t.isSearchLoading=!1})},handleChangeLocation:function(e){"3"===this.$store.state.userType?(this.formData.streetCode=e[0]||"",this.formData.communityCode=e[1]||""):"4"===this.$store.state.userType?this.formData.communityCode=e[0]||"":(this.formData.zoneCode=e[0]||"",this.formData.streetCode=e[1]||"",this.formData.communityCode=e[2]||"")},getLocation:function(){var e=this;c.a.getLocationList().then(function(t){var a=t.data,i=e.$store.state.code[0]||"";if(a&&a.length>0){var l=a.filter(function(e){return"河西区"===e.name})[0].childs,s=i?e.getLocalListByCode(l,i):[];e.locationOptions=s.length>0?s:l}}).catch(function(){console.log("查询片区数据失败")})},getLocalListByCode:function(e,t){var a=[];return function e(i){var l=[];if(i&&(l=i.filter(function(a){return a.code===t||!!(a.childs&&a.childs.length>0)&&void e(a.childs)})).length>0)return a=l,!1}(e),a},openDialog:function(){this.$store.commit("setNavDialogVisible",!0)},getSearchValue:function(){this.currentPage=1,this.getOlderData()},clearSearchValue:function(){this.formData={sex:"",zoneCode:"",streetCode:"",communityCode:"",name:"",idCard:"",phone:""},this.selectedLocation=[]}},components:{ListLayout:u.a,smallLayout:d.a}},p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("list-layout",{attrs:{columns:e.columns,tableData:e.tableData,total:e.total,pageSize:e.pageSize,currentPage:e.currentPage,dialogVisible:e.dialogVisible,checkData:e.checkData,backPath:"ServiceVolunteer",header:"志愿者服务数据统计",title:"志愿者服务大数据统计————志愿者入户探访服务记录"},on:{getSearchValue:e.handleGetSearchValue,"update:dialogVisible":function(t){e.dialogVisible=t},"update:dialog-visible":function(t){e.dialogVisible=t},"update:checkData":function(t){e.checkData=t},"update:check-data":function(t){e.checkData=t}}},[a("el-form",{attrs:{inline:!0,model:e.formData}},[a("el-form-item",{staticClass:"search_select",attrs:{label:"街道社区"}},[a("el-cascader",{attrs:{placeholder:"选择地区",options:e.locationOptions,"show-all-levels":!1,"change-on-select":"",filterable:"",clearable:"",props:e.locationProps},on:{change:e.handleChangeLocation},model:{value:e.selectedLocation,callback:function(t){e.selectedLocation=t},expression:"selectedLocation"}})],1),e._v(" "),a("el-form-item",{staticClass:"search_select",attrs:{label:"姓名"}},[a("el-input",{staticClass:"head_left",attrs:{placeholder:"请输入姓名",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getSearchValue.apply(null,arguments)}},model:{value:e.formData.intervieweeName,callback:function(t){e.$set(e.formData,"intervieweeName","string"==typeof t?t.trim():t)},expression:"formData.intervieweeName"}})],1),e._v(" "),a("el-form-item",{staticClass:"search_select",attrs:{label:"身份证号码"}},[a("el-input",{staticClass:"head_left",attrs:{placeholder:"请输入身份证号码",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getSearchValue.apply(null,arguments)}},model:{value:e.formData.intervieweeCard,callback:function(t){e.$set(e.formData,"intervieweeCard","string"==typeof t?t.trim():t)},expression:"formData.intervieweeCard"}})],1),e._v(" "),a("el-form-item",{staticClass:"search_select",attrs:{label:"联系电话"}},[a("el-input",{staticClass:"head_left",attrs:{placeholder:"请输入联系电话",clearable:""},model:{value:e.formData.phone,callback:function(t){e.$set(e.formData,"phone","string"==typeof t?t.trim():t)},expression:"formData.phone"}})],1),e._v(" "),a("el-form-item",{staticClass:"search_select",attrs:{label:"探访人员"}},[a("el-input",{staticClass:"head_left",attrs:{placeholder:"请输入探访人员",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getSearchValue.apply(null,arguments)}},model:{value:e.formData.greetStaff,callback:function(t){e.$set(e.formData,"greetStaff","string"==typeof t?t.trim():t)},expression:"formData.greetStaff"}})],1),e._v(" "),a("el-form-item",{staticClass:"search_select",attrs:{label:"探访时间"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"-",clearable:"","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.mealTime,callback:function(t){e.mealTime=t},expression:"mealTime"}})],1)],1),e._v(" "),a("div",{staticClass:"btns_box"},[a("div",{staticClass:"btns_right"},[a("el-button",{staticClass:"btn",on:{click:e.clearSearchValue}},[e._v("重置")]),e._v(" "),a("el-button",{staticClass:"btn",attrs:{icon:"el-icon-search",loading:e.isSearchLoading},on:{click:e.handleGetSearchValue}},[e._v("查询")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"查看入户探访服务记录表",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("ol",{staticClass:"detial_content"},[a("div",{staticClass:"tit"},[e._v("基本信息")]),e._v(" "),a("li",{staticClass:"detial_item"},[a("div",{staticClass:"item_contnet"},[a("span",{staticClass:"item_label"},[e._v("所属街道社区：")]),e._v(" "),a("span",{staticClass:"item_value"},[e._v(e._s(e.checkData.streetName))])])]),e._v(" "),a("li",{staticClass:"detial_item"},[a("div",{staticClass:"item_contnet"},[a("span",{staticClass:"item_label"},[e._v("被访姓名：")]),e._v(" "),a("span",{staticClass:"item_value"},[e._v(e._s(e.checkData.intervieweeName))])])]),e._v(" "),a("li",{staticClass:"detial_item"},[a("div",{staticClass:"item_contnet"},[a("span",{staticClass:"item_label"},[e._v("被访人身份证号：")]),e._v(" "),a("span",{staticClass:"item_value"},[e._v(e._s(e.checkData.intervieweeCard))])])]),e._v(" "),a("li",{staticClass:"detial_item"},[a("div",{staticClass:"item_contnet"},[a("span",{staticClass:"item_label"},[e._v("电话：")]),e._v(" "),a("span",{staticClass:"item_value"},[e._v(e._s(e.checkData.phone))])])]),e._v(" "),a("li",{staticClass:"detial_item"},[a("div",{staticClass:"item_contnet"},[a("span",{staticClass:"item_label"},[e._v("住址：")]),e._v(" "),a("span",{staticClass:"item_value"},[e._v(e._s(e.checkData.address))])])]),e._v(" "),a("small-layout",{attrs:{columns:e.columnsPro,tableData:e.smallTabData,pageSize:5,currentPage:e.currentPage||1,total:e.smallTotal},on:{getSmallValue:e.handleGetSmallValue}})],1)])],1)};p._withStripped=!0;var f={render:p,staticRenderFns:[]},v=f;var g=a("VU/8")(h,v,!1,null,null,null);g.options.__file="src/views/VisitService/index.vue";t.default=g.exports}});